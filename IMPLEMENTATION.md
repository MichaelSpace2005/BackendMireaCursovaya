# Evolution Tree Backend - Updated Implementation

## ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. **–°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**
- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π email
- **JWT —Ç–æ–∫–µ–Ω—ã** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- **Email —Ç–æ–∫–µ–Ω—ã** –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º

### 2. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥**
- **Cytoscape.js** –≥—Ä–∞—Ñ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ö–∞–Ω–∏–∫
- **Drag-and-drop** - –ø–µ—Ä–µ–º–µ—â–∞–π—Ç–µ —É–∑–ª—ã –≤ –≥—Ä–∞—Ñ–µ
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –º–µ—Ö–∞–Ω–∏–∫–∏ –∏ —Å–≤—è–∑–∏
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω** —Å –∫—Ä–∞—Å–∏–≤—ã–º UI

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
pip install -r requirements.txt
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL (–µ—Å–ª–∏ –Ω–µ—Ç)
```bash
# –ß–µ—Ä–µ–∑ docker-compose
docker-compose up -d db

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ –≤ PostgreSQL
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
```bash
uvicorn app.main:app --reload
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: `http://localhost:8000`

## üìã API Endpoints

### Auth
- `POST /api/v1/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/v1/auth/verify-email` - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email
- `POST /api/v1/auth/login` - –í—Ö–æ–¥
- `GET /api/v1/auth/me` - –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω)

### Mechanics (—Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω)
- `POST /api/v1/mechanics/` - –°–æ–∑–¥–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∫—É
- `GET /api/v1/mechanics/` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–µ—Ö–∞–Ω–∏–∫
- `POST /api/v1/mechanics/links` - –°–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—å
- `GET /api/v1/mechanics/links` - –í—Å–µ —Å–≤—è–∑–∏
- `GET /api/v1/mechanics/{id}/tree` - –î–µ—Ä–µ–≤–æ —ç–≤–æ–ª—é—Ü–∏–∏ –º–µ—Ö–∞–Ω–∏–∫–∏

## üé® –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

### Users (`users`)
- id, email, username, hashed_password, is_verified, created_at

### Email Tokens (`email_tokens`)
- id, user_id, token, created_at, expires_at, is_used

### Mechanics (`mechanics`)
- id, name, description, year

### Links (`links`)
- id, from_id, to_id, type

## üîß –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**
   - –ù–∞–∂–º–∏—Ç–µ "Register"
   - –í–≤–µ–¥–∏—Ç–µ username, email, –ø–∞—Ä–æ–ª—å
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ (–∏–ª–∏ –≤ –±–æ–µ–≤–æ–º —Ä–µ–∂–∏–º–µ - –∏–∑ email)
   - –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Ñ–æ—Ä–º—É –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

2. **–í—Ö–æ–¥**
   - –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å

3. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∫—É**
   - –í–≤–µ–¥–∏—Ç–µ –∏–º—è, –æ–ø–∏—Å–∞–Ω–∏–µ, –≥–æ–¥
   - –ù–∞–∂–º–∏—Ç–µ "Add Mechanic"

4. **–î–æ–±–∞–≤–∏—Ç—å —Å–≤—è–∑—å**
   - –í–≤–µ–¥–∏—Ç–µ ID –º–µ—Ö–∞–Ω–∏–∫ (from/to)
   - –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–≤—è–∑–∏
   - –ù–∞–∂–º–∏—Ç–µ "Add Link"

5. **–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ä–µ–≤–æ**
   - –í–≤–µ–¥–∏—Ç–µ ID –∫–æ—Ä–Ω–µ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏
   - –ù–∞–∂–º–∏—Ç–µ "View Tree"

6. **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≥—Ä–∞—Ñ–æ–º**
   - –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —É–∑–µ–ª –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
   - –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —É–∑–µ–ª –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ mouse wheel –¥–ª—è zoom

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **TODO –¥–ª—è production:**
- –ò–∑–º–µ–Ω–∏—Ç—å SECRET_KEY –≤ `app/infra/security.py`
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email —á–µ—Ä–µ–∑ SMTP
- –î–æ–±–∞–≤–∏—Ç—å rate limiting
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å https
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ entities/              # Domain models
‚îÇ   ‚îú‚îÄ‚îÄ mechanic.py
‚îÇ   ‚îú‚îÄ‚îÄ link.py
‚îÇ   ‚îî‚îÄ‚îÄ user.py           # NEW
‚îú‚îÄ‚îÄ use_cases/            # Business logic
‚îÇ   ‚îú‚îÄ‚îÄ create_mechanic.py
‚îÇ   ‚îú‚îÄ‚îÄ get_tree.py
‚îÇ   ‚îî‚îÄ‚îÄ auth.py           # NEW
‚îú‚îÄ‚îÄ interfaces/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ v1/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_routes.py      # NEW
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_schemas.py     # NEW
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mechanics_routes.py # NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dependencies.py         # UPDATED
‚îÇ   ‚îî‚îÄ‚îÄ repos/
‚îÇ       ‚îú‚îÄ‚îÄ mechanic_repo.py
‚îÇ       ‚îú‚îÄ‚îÄ link_repo.py
‚îÇ       ‚îî‚îÄ‚îÄ user_repo.py            # NEW
‚îî‚îÄ‚îÄ infra/
    ‚îú‚îÄ‚îÄ database/
    ‚îÇ   ‚îú‚îÄ‚îÄ models.py               # UPDATED
    ‚îî‚îÄ‚îÄ repos_impl/
        ‚îú‚îÄ‚îÄ mechanic_repo_impl.py
        ‚îú‚îÄ‚îÄ link_repo_impl.py
        ‚îî‚îÄ‚îÄ user_repo_impl.py       # NEW
```

## üéØ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ SMTP
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
- [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∫
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∫
- [ ] –ü–æ–∏—Å–∫ –ø–æ –º–µ—Ö–∞–Ω–∏–∫–∞–º
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —É–∑–ª–æ–≤ –≤ –≥—Ä–∞—Ñ–µ
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–µ—Ä–µ–≤–∞ –≤ JSON/SVG
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è API
